#!/bin/sh -e
MYINIT_SERVICE_PATH=${MYINIT_SERVICE_PATH:-/etc/myinit/services.d}
service="$2"
[ -n "$service" ] && [ -f "$MYINIT_SERVICE_PATH/$service" ]
case "$1" in
create)
    cat - > "$MYINIT_SERVICE_PATH/$service"
    ;;
delete)
    rm "$MYINIT_SERVICE_PATH/$service"
    ;;
disable)
    chmod -x "$MYINIT_SERVICE_PATH/$service"
    ;;
enable)
    chmod u+x "$MYINIT_SERVICE_PATH/$service"
    ;;
respawn)
    read -r pid < "$MYINIT_SERVICE_PATH/.$service.pid"
    kill -SIGHUP "$pid"
    ;;
restart)
    read -r pid < "$MYINIT_SERVICE_PATH/.$service.pid"
    pkill -P "$pid"
    ;;
signal)
    read -r pid < "$MYINIT_SERVICE_PATH/.$service.pid"
    # shellcheck disable=SC2086
    pkill $2 -P "$pid"
    ;;
start)
    service-spawn "$MYINIT_SERVICE_PATH/$service" &
    ;;
stop)
    read -r pid < "$MYINIT_SERVICE_PATH/.$service.pid"
    kill "$pid"
    ;;
*)
    echo "Invalid action '$1'"
    exit 1
    ;;
esac
